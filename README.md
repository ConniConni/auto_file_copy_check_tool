# 自動ファイルコピーチェックツール

プロジェクトにおいて、内部作業用エリアと外部提出用エリアの間で、ドキュメントやレビュー記録表の受け渡し（コピー）を支援するCLIツールです。

## 目次

- [機能概要](#機能概要)
- [インストール](#インストール)
  - [必要要件](#必要要件)
  - [セットアップ手順](#セットアップ手順)
- [使用方法](#使用方法)
  - [基本的な使い方](#基本的な使い方)
  - [実行例](#実行例)
- [ディレクトリ構造](#ディレクトリ構造)
  - [内部エリア](#内部エリアプロジェクトメンバー作業用)
  - [外部エリア](#外部エリアお客様との共有用)
- [動作モード](#動作モード)
  - [Outgoing](#outgoing内部外部提出)
  - [Incoming](#incoming外部内部取込)
- [Excelファイル内容チェック](#excelファイル内容チェック)
- [テスト](#テスト)
- [プロジェクト構造](#プロジェクト構造)
- [トラブルシューティング](#トラブルシューティング)
- [ライセンス](#ライセンス)
- [作成者](#作成者)
- [更新履歴](#更新履歴)

## 機能概要

- **双方向コピー**: 「内部→外部（提出）」と「外部→内部（取込）」の両方に対応
- **ミス防止**: 手動操作によるコピー忘れ、誤った上書き、古いファイルの混入を防ぐ
- **品質担保**: ドキュメントの内容不備を検出し、警告としてユーザーに知らせる（コピー自体は阻害しない）
- **環境対応**: Windows/macOS両対応。パスエラーやファイルロック時のクラッシュを防ぐ堅牢な設計
- **柔軟な設定**: カスタム設定ファイル指定（`-i`オプション）とプロジェクト情報の事前設定により、複数案件の管理が容易
- **柔軟なディレクトリ構造**: アイテム名階層が不要なプロジェクトにも対応（item_name省略可能）

## インストール

### 必要要件

- Python 3.10以降

### セットアップ手順

1. リポジトリのクローンまたはダウンロード

2. 依存パッケージのインストール:
```bash
pip install -r requirements.txt
```

3. 設定ファイルの編集:

`config.ini` ファイルを開き、以下の項目を設定してください。

```ini
[Paths]
# 内部エリア（プロジェクトメンバー作業用）のベースパス
base_path_internal = /path/to/internal/area

# 外部エリア（お客様との共有用）のベースパス
base_path_external = /path/to/external/area

[Documents]
# 各工程のドキュメント本体ファイル名パターン（プレフィックス、カンマ区切りで複数指定可能）
030 = 調査検討書
040 = 機能設計書
050 =
060 = 単体試験仕様書
070 = 単体試験成績書
080 = 結合試験仕様書
090 = 結合試験成績書,試験結果報告書

[ExtraFiles]
# 例外ファイル（完全一致のファイル名、カンマ区切り）
# 例: 補足資料.pdf,説明書.docx
include_files =

[Project]
# プロジェクト情報のデフォルト値（空欄の場合は実行時に入力を求める）
# 案件名
project_name =

# クォータ（例: 2025_4Q）
quarter =

# アイテム名
item_name =
```

**プロジェクト情報について:**
- `[Project]`セクションに案件名、クォータ、アイテム名を設定することで、実行時の入力を省略できます
- 空欄にした場合は、従来通り実行時に対話的入力を求めます
- `-i`オプションで複数の設定ファイルを切り替えれば、複数案件を簡単に管理できます

**アイテム名について:**
- アイテム名を空欄にすることで、アイテム名階層を省略したディレクトリ構造に対応できます
- 例: `base_path/案件名/クォータ/工程名/` （アイテム名階層なし）
- config.iniで `item_name =` と空欄にするか、実行時に空欄で入力することで利用可能

## 使用方法

### 基本的な使い方

**デフォルトの設定ファイル（config.ini）を使用する場合:**

```bash
python -m src.main
```

**カスタム設定ファイルを指定する場合:**

```bash
python -m src.main -i ./path/to/custom_config.ini
```

または

```bash
python -m src.main --config /absolute/path/to/config.ini
```

ツールを起動すると、以下の情報を入力するよう求められます:

1. **案件名**: プロジェクト名を入力
2. **クォータ**: 例: `2025_4Q`
3. **アイテム名**: アイテム名を入力（空欄可能 - アイテム名階層をスキップ）
4. **工程選択**:
   - 1-7: 特定の工程を選択
   - 8: 全工程を一括処理
5. **動作モード**:
   - 1: Outgoing (内部→外部: 提出)
   - 2: Incoming (外部→内部: 取込)
6. **期間フィルタ**: N日前以降に更新されたファイルのみを対象
   - 0: 今日のみ
   - 1: 昨日以降
   - 7: 7日前以降

### 実行例

**例1: デフォルト設定で実行**

```bash
python -m src.main
```

**例2: カスタム設定ファイルで実行**

```bash
python -m src.main -i ./configs/project_a.ini
```

**例3: プロジェクト情報を事前設定（頻繁に使う案件の場合）**

config.iniに以下のように設定すると、実行時の入力を省略できます：

```ini
[Project]
project_name = DeveloperSite対応
quarter = 2025_4Q
item_name = ディベロッパサイト環境移行対応
```

この場合、実行すると以下のように表示されます：

```
=== ファイルコピーチェックツール ===

案件名: DeveloperSite対応 (config.iniから取得)
クォータ: 2025_4Q (config.iniから取得)
アイテム名: ディベロッパサイト環境移行対応 (config.iniから取得)

工程を選択してください:
...
```

**実行時の出力例（対話的入力の場合）:**

```
=== ファイルコピーチェックツール ===

案件名を入力してください: DeveloperSite対応
クォータを入力してください (例: 2025_4Q): 2025_4Q
アイテム名を入力してください: ディベロッパサイト環境移行対応

工程を選択してください:
1. 030.調査
2. 040.設計
3. 050.製造
4. 060.UD作成
5. 070.UD消化
6. 080.SD作成
7. 090.SD消化
8. 全工程
選択 (1-8): 1

動作モードを選択してください:
1. Outgoing (内部→外部: 提出)
2. Incoming (外部→内部: 取込)
選択 (1-2): 1

期間フィルタ（N日前以降、0=今日のみ）: 0

=== スキャン結果 ===

【ドキュメント本体】 (1件)
  - 調査検討書_DeveloperSite対応_ディベロッパサイト環境移行対応.xlsx

【レビュー記録表】 (2件)
  - レビュー記録表(社外)_1回目_調査_DeveloperSite対応.xlsx [OK]
  - レビュー記録表(社外)_2回目_調査_DeveloperSite対応.xlsx [OK]

合計: 3件

コピーを実行しますか？ (y/n): y

コピーを実行中...

=== 実行結果 ===
成功: 3件
失敗: 0件

ログファイル: file_copy_tool_20251223_143025.log
```

## ディレクトリ構造

### 内部エリア（プロジェクトメンバー作業用）

```
[工程名]/ (例: 030.調査)
├── ドキュメント本体.xlsx  ← 配置場所A（コピー元/先）
└── 成果物/
    ├── 内部レビュー/
    │   └── 20251215/  ← 日付フォルダ（ある場合とない場合がある）
    │       ├── レビュー記録表_調査_社内_1回目_xxx.xlsx
    │       └── レビューチェックリスト_030_社内_1回目_xxx.xlsx
    │
    └── 外部レビュー/
        └── 20251219/  ← 日付フォルダ（ある場合とない場合がある）
            ├── レビュー記録表(社外)_1回目_調査_xxx.xlsx  ← コピー対象
            └── レビューチェックリスト_030_社外_1回目_xxx.xlsx
```

### 外部エリア（お客様との共有用）

```
[工程名]/ (例: 030.調査)
├── ドキュメント本体.xlsx  ← コピー先/元
└── 成果物/
    └── レビュー記録表(社外)_1回目_調査_xxx.xlsx  ← コピー先/元
```

## 動作モード

### Outgoing（内部→外部：提出）

**対象工程**: `030`, `040`, `080`, `090`

**コピールール**:
1. ドキュメント本体: `[内部]/[工程名]/` → `[外部]/[工程名]/`
2. レビュー記録表（社外）: `[内部]/[工程名]/成果物/外部レビュー/**/` → `[外部]/[工程名]/成果物/`
3. 例外ファイル: `[内部]/[工程名]/成果物/外部レビュー/` → `[外部]/[工程名]/成果物/`

### Incoming（外部→内部：取込）

**対象工程**: 全工程

**コピールール**:
1. ドキュメント本体: `[外部]/[工程名]/` → `[内部]/[工程名]/`
2. レビュー記録表: `[外部]/[工程名]/成果物/` → `[内部]/[工程名]/**/` (再帰検索で同名ファイルを探して上書き)

## Excelファイル内容チェック

Outgoingモード時、以下のチェックを実行します（警告のみ、コピーは実行されます）:

### レビュー記録表のチェック項目
- `AE2` (レビュー名称): 必須
- `AE8` (内部メンバ): 必須
- `AE7` (外部メンバ): ファイル名に `(社外)` を含む場合のみ必須

### レビューチェックリストのチェック項目
- `E4-E6` (案件情報): 必須
- `N6` (日付): 必須
- `M15` (外部メンバ): ファイル名に `社外` を含む場合のみ必須

## テスト

### テストの実行

全テストを実行:
```bash
pytest
```

特定のモジュールのテストを実行:
```bash
pytest tests/test_config_loader.py -v
pytest tests/test_file_scanner.py -v
pytest tests/test_excel_checker.py -v
pytest tests/test_file_copier.py -v
```

カバレッジレポート付きで実行:
```bash
pytest --cov=src --cov-report=html
```

## プロジェクト構造

```
auto_file_copy_check_tool/
├── src/
│   ├── __init__.py
│   ├── main.py                 # メインCLIアプリケーション
│   ├── config_loader.py        # 設定ファイル読み込み
│   ├── file_scanner.py         # ファイルスキャン
│   ├── file_copier.py          # ファイルコピー
│   └── excel_checker.py        # Excel内容チェック
├── tests/
│   ├── __init__.py
│   ├── test_config_loader.py
│   ├── test_file_scanner.py
│   ├── test_file_copier.py
│   └── test_excel_checker.py
├── config.ini                   # 設定ファイル
├── requirements.txt             # 依存パッケージ
├── README.md                    # 本ファイル
└── CLAUDE.md                    # 詳細仕様書
```

## トラブルシューティング

### Excelファイルが開かれているエラー

**症状**: `PermissionError` が発生してコピーできない

**対処法**:
- コピー対象のExcelファイルを閉じてから再実行してください
- ツールはエラーをログに記録し、次のファイルへ進みます

### パスが見つからないエラー

**症状**: `ディレクトリが存在しません` というエラー

**対処法**:
1. `config.ini` のパス設定を確認
2. 案件名、クォータ、アイテム名が正しいか確認
3. ディレクトリ構造が仕様に沿っているか確認

### コピー先が見つからない警告（Incomingモード）

**症状**: `コピー先が見つかりません（スキップ）` という警告

**対処法**:
- 内部エリアに同名のファイルが存在しない場合に発生します
- 手動で該当ファイルを配置してから再実行してください

## ライセンス

社内ツール（個人使用）

## 作成者

Koni

## 更新履歴

- 2025-12-23:
  - 初版リリース
  - カスタム設定ファイル指定機能追加（`-i`/`--config`オプション）
  - プロジェクト情報のデフォルト値設定機能追加（config.iniの`[Project]`セクション）
  - アイテム名省略可能機能追加（アイテム名階層が不要なプロジェクトに対応）
