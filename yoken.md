# Claude codeへ伝える要件：Python製業務効率化CLIツール（双方向ファイル受け渡し支援）

## 1. アプリケーション概要
プロジェクトにおいて、内部作業用エリアと外部提出用エリアの間で、ドキュメントやレビュー記録表の受け渡し（コピー）を支援する**CLIツール**を作成する。

### 目的と解決する課題
*   **双方向コピー:** 「内部→外部（提出）」と「外部→内部（取込）」の両方に対応する。
*   **ミス防止:** 手動操作によるコピー忘れ、誤った上書き、古いファイルの混入を防ぐ。
*   **品質担保:** ドキュメントの内容不備（必須項目の未記載など）を検出し、**警告**としてユーザーに知らせる（コピー自体は阻害しない）。
*   **環境対応:** Windows/macOS両対応。パスエラーやファイルロック時のクラッシュを防ぐ堅牢な設計。

## 2. ディレクトリ構造の定義（厳格）

ツールは設定ファイルのベースパスとユーザー入力を結合し、以下の構造を前提に動作する。
フォルダ名「成果物」「内部」「外部」は固定名称とする。

**パス構築:** `[base_path]/[案件名]/[yyyy_xQ]/[アイテム名]/[工程名]/...`

```text
[工程名フォルダ] (例: .../xxxxxxx/030.調査)
  │
  ├ [ドキュメント本体] (例: 調査検討書_xxx.xlsx)  <-- ★配置場所A
  │
  └ 成果物
     ├ 内部  (プロジェクトメンバー作業用)
     │  └ [レビュー記録表] (例: レビュー記録表(社内/社外)...xlsx) <-- ★配置場所B
     │  └ [レビューチェックリスト] (コピー対象外だがチェック対象)
     │
     └ 外部  (お客様提出・共有用)
        ├ [ドキュメント本体] (コピー先/元)
        └ [レビュー記録表]   (コピー先/元)
```

*   **工程定義:**
    *   `030.調査` / `040.設計` / `050.CD` / `060.UD作成` / `070.UD消化` / `080.SD作成` / `090.SD消化`
    *   ※ディレクトリ名は上記文字列と完全一致するものとする。

## 3. 機能要件

### 3.1. 動作モードとコピールール

起動時にモード（Outgoing / Incoming）を選択し、以下のルールでファイルを移動する。

#### ① 内部 → 外部 (Outgoing: 提出)
*   **概要:** 内部の最新ファイルを、外部用フォルダへコピーする。
*   **対象工程:** `030`, `040`, `080`, `090`
*   **コピールール:**
    1.  **ドキュメント本体:**
        *   元: `[工程名]` 直下の定義済みドキュメント（配置場所A）
        *   先: `[工程名]/成果物/外部/`
    2.  **レビュー記録表:**
        *   元: `[工程名]/成果物/内部/` 直下の `レビュー記録表(社外)*.xlsx`（配置場所B）
        *   先: `[工程名]/成果物/外部/`
        *   ※「レビューチェックリスト」および「(社内)」を含むファイルは対象外。
    3.  **例外ファイル:**
        *   元: `[工程名]/成果物/内部/` 内で設定ファイルのパターン（例: `*.pdf`）に一致するもの。
        *   先: `[工程名]/成果物/外部/`

#### ② 外部 → 内部 (Incoming: 取込)
*   **概要:** 外部フォルダ（お客様からの返却など）にあるファイルを、内部の所定の位置へ上書きコピーする。
*   **対象工程:** 全工程
*   **コピールール:**
    1.  **ドキュメント本体:**
        *   元: `[工程名]/成果物/外部/[ドキュメントファイル]`
        *   先: `[工程名]/` 直下（配置場所A）へ上書きコピー。
        *   ※内部にファイルが存在しない場合は、新規コピーとして扱う。
    2.  **レビュー記録表:**
        *   元: `[工程名]/成果物/外部/[レビュー記録表]`
        *   先: **`[工程名]` ディレクトリ配下** を再帰的に検索し、ファイル名が完全一致するファイルがあれば、その場所へ上書きコピー。
        *   **警告:** 内部（`[工程名]`配下）に同名ファイルが1つも見つからない場合、「コピー先不明」として警告ログを出し、コピーはスキップする。

### 3.2. 共通ロジック (期間フィルタ)
*   **仕様:** ユーザー入力値 `N` (日数) に基づき、**「N日前の0:00以降」** に更新されたファイルのみを対象とする。
    *   `0`: 今日 (Today 0:00 ~ Now)
    *   `1`: 昨日以降 (Yesterday 0:00 ~ Now)

### 3.3. ドキュメント内容チェック（品質確認）
*   **位置付け:** コピー可否には影響しない「警告」機能。Outgoingモード時に特に有効。
*   **対象:** コピー候補ファイル および `成果物/内部` にあるレビューチェックリスト。
*   **チェック項目:**
    *   **レビュー記録表:** `AE2`(レビュー名称), `AE8`(内部メンバ) は必須。`AE7`(外部メンバ) はファイル名に`(社外)`を含む場合のみ必須。
    *   **レビューチェックリスト:** `E4-E6`(案件情報), `N6`(日付), `M15`(外部メンバ/社外時のみ) をチェック。

## 4. 技術要件

*   **言語:** Python 3.10+
*   **設定ファイル (`config.ini`):**
    *   `[Settings]` セクション: `base_path` (プロジェクトルート)
    *   `[ExtraFiles]` セクション: `include_patterns` (カンマ区切りのワイルドカード)
*   **堅牢性:**
    *   **ファイルロック対応:** Excelファイルが開かれていてアクセスできない場合 (`PermissionError`)、ツールをクラッシュさせず、エラーログを出力して次のファイルへ進むこと。
    *   **パス操作:** `pathlib` を使用し、Windows/macOSの両方のパス区切りに対応すること。

## 5. CLI インタラクションフロー

1.  **初期設定:**
    *   `config.ini` ロード。
    *   ユーザー入力: 案件名, クォータ, アイテム名, 工程(リスト選択), モード(1:提出/2:取込), 期間(日数)。
2.  **スキャン & Dry Run表示:**
    *   構成されたパスが存在するか確認（なければエラー終了）。
    *   対象となるファイル一覧を表示。
    *   Outgoingモード時は、Excelの内容チェック結果（OK/NG）を併記する。
    *   Incomingモード時は、「上書き対象が見つかりません」等の警告があれば表示する。
3.  **実行確認:** ユーザーが `y` を入力した場合のみコピーを実行。
4.  **完了:** ログファイルに結果を出力。

## 6. 成果物
*   `main.py` (スクリプト本体)
*   `config.ini` (設定ファイルテンプレート)
*   `requirements.txt`
