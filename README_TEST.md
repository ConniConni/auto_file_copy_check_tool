# テスト実行ガイド

このガイドでは、テスト用のディレクトリとファイルを使ってツールの動作を確認する方法を説明します。

## テスト環境の構成

### ディレクトリ構造

```
test_data/
├── internal/                           # 内部エリア（プロジェクトメンバー作業用）
│   └── DeveloperSite対応/
│       └── 2025_4Q/
│           └── ディベロッパサイト環境移行対応/
│               └── 030.調査/
│                   ├── 調査検討書_DeveloperSite対応_ディベロッパサイト環境移行対応.xlsx
│                   └── 成果物/
│                       ├── 内部レビュー/
│                       │   └── レビュー記録表_調査_社内_1回目_DeveloperSite対応.xlsx
│                       └── 外部レビュー/
│                           ├── 20251219/
│                           │   └── レビュー記録表(社外)_1回目_調査_DeveloperSite対応.xlsx
│                           └── レビュー記録表(社外)_2回目_調査_DeveloperSite対応.xlsx
│
└── external/                           # 外部エリア（お客様との共有用）
    └── DeveloperSite対応/
        └── 2025_4Q/
            └── ディベロッパサイト環境移行対応/
                └── 030.調査/
                    └── 成果物/                 # コピー先（最初は空）
```

### テストファイル

- **ドキュメント本体**: 調査検討書_DeveloperSite対応_ディベロッパサイト環境移行対応.xlsx
- **レビュー記録表（社外）**:
  - レビュー記録表(社外)_1回目_調査_DeveloperSite対応.xlsx（日付フォルダ内）
  - レビュー記録表(社外)_2回目_調査_DeveloperSite対応.xlsx（日付フォルダなし）
- **レビュー記録表（社内）**: レビュー記録表_調査_社内_1回目_DeveloperSite対応.xlsx（コピー対象外）

## テスト実行手順

### 1. Outgoing（内部→外部：提出）モードのテスト

テスト用設定ファイルを使ってツールを実行します。

```bash
python -m src.main -i config_test.ini
```

実行時の選択肢：

```
工程を選択してください:
1. 030.調査
...
選択 (1-8): 1

動作モードを選択してください:
1. Outgoing (内部→外部: 提出)
2. Incoming (外部→内部: 取込)
選択 (1-2): 1

期間フィルタ（N日前以降、0=今日のみ）: 0

ログ出力モードを選択してください:
1. 通常モード（INFO以上）
2. 詳細モード（DEBUG以上 - トラブルシューティング用）
選択 (1-2): 2
```

**期待される結果:**

```
=== スキャン結果 ===

【ドキュメント本体】 (1件)
  - 調査検討書_DeveloperSite対応_ディベロッパサイト環境移行対応.xlsx

【レビュー記録表】 (2件)
  - レビュー記録表(社外)_1回目_調査_DeveloperSite対応.xlsx [OK]
  - レビュー記録表(社外)_2回目_調査_DeveloperSite対応.xlsx [OK]

合計: 3件

コピーを実行しますか？ (y/n): y

コピーを実行中...

=== 実行結果 ===
成功: 3件
失敗: 0件
```

### 2. コピー結果の確認

外部エリアにファイルがコピーされたことを確認します。

```bash
find test_data/external -name "*.xlsx"
```

**期待される出力:**

```
test_data/external/DeveloperSite対応/2025_4Q/ディベロッパサイト環境移行対応/030.調査/調査検討書_DeveloperSite対応_ディベロッパサイト環境移行対応.xlsx
test_data/external/DeveloperSite対応/2025_4Q/ディベロッパサイト環境移行対応/030.調査/成果物/レビュー記録表(社外)_1回目_調査_DeveloperSite対応.xlsx
test_data/external/DeveloperSite対応/2025_4Q/ディベロッパサイト環境移行対応/030.調査/成果物/レビュー記録表(社外)_2回目_調査_DeveloperSite対応.xlsx
```

### 3. Incoming（外部→内部：取込）モードのテスト

外部エリアのファイルを編集してから、内部エリアへ取り込みます。

```bash
python -m src.main -i config_test.ini
```

実行時の選択肢：

```
選択 (1-8): 1
選択 (1-2): 2  # Incoming
期間フィルタ（N日前以降、0=今日のみ）: 0
選択 (1-2): 2  # 詳細モード
```

**期待される結果:**
- ドキュメント本体が内部エリアへ上書きコピーされる
- レビュー記録表が内部エリアの対応するファイルへ上書きコピーされる

## デバッグログの活用

詳細モード（ログモード2）を選択すると、以下の情報が表示されます：

- **設定ファイル読み込み**:
  ```
  [DEBUG] [設定ファイル読み込み開始] config_test.ini
  [DEBUG] 内部ベースパス: /Users/koni/Desktop/auto_file_copy_check_tool/test_data/internal
  [DEBUG] 外部ベースパス: /Users/koni/Desktop/auto_file_copy_check_tool/test_data/external
  ```

- **パス構築**:
  ```
  [DEBUG] パス構築: base=/Users/.../test_data/internal |
          案件=DeveloperSite対応 | Q=2025_4Q |
          アイテム=ディベロッパサイト環境移行対応 |
          工程=030.調査 → /Users/.../test_data/internal/DeveloperSite対応/2025_4Q/...
  ```

- **ファイル検索**:
  ```
  [DEBUG] [ドキュメントスキャン開始] 工程=030 モード=OUTGOING
  [DEBUG] 検索パターン: ['調査検討書']
  [DEBUG] パターンで検索中: 調査検討書_*.xlsx in /Users/.../030.調査
  [DEBUG] パターン '調査検討書' で 1 件のファイルが見つかりました
  ```

- **期間フィルタ**:
  ```
  [DEBUG] ファイル時刻チェック: 調査検討書_....xlsx |
          更新日時=2025-12-23 15:30:45 |
          カットオフ=2025-12-23 00:00:00 |
          結果=OK
  ```

## トラブルシューティング

### コピー対象が見つからない場合

詳細モードで以下を確認してください：

1. **パスが正しく構築されているか**
   - ログで`パス構築`の出力を確認
   - 案件名、クォータ、アイテム名が正しいか確認

2. **ディレクトリが存在するか**
   - `工程ディレクトリが存在しません`というログがないか確認

3. **ファイル名パターンがマッチしているか**
   - `パターンで検索中`のログを確認
   - config.iniのパターン設定が正しいか確認

4. **期間フィルタで除外されていないか**
   - `ファイル時刻チェック`のログを確認
   - 必要に応じて期間フィルタの日数を増やす

## テスト環境のクリーンアップ

テストデータを削除する場合：

```bash
rm -rf test_data
rm config_test.ini
rm create_test_files.py
```

**注意**: 本番環境では慎重に操作してください。
